<!-- Header -->
<div class="col-md-12" id="head">
    <div class="col-md-6">
        <div style="margin-bottom:10px;margin-top:10px;">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>SKPD</label></div>
                <div class="col-sm-8">
                    <input id="kd_skpd" name="kd_skpd" type="text" class="easyui-textbox" style="width:80%;">
                </div>  
            </div>
        </div>
        <div style="margin-bottom:10px">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>UNIT</label></div>
                <div class="col-sm-8">
                    <input id="kd_unit" name="kd_unit" type="text" class="easyui-textbox" style="width:80%;">
                </div>  
            </div>
        </div>
        <div style="margin-bottom:10px">
            <div class="col-sm-12" style="padding-top: 10px;padding-bottom: 10px;">
                <div class="col-sm-4"><label>Data Kontrak</label></div>
                <div class="col-sm-8">
                    <input id='sb' class="easyui-switchbutton" checked >
                </div>
            </div> 
        </div>
        <div style="margin-bottom:10px">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Kontrak</label></div>
                <div class="col-sm-8">
                    <div id="kn"><input id="kontrak" name="kontrak" type="text" class="easyui-textbox" style="width:80%;"></div>
                    <div id="km"><input id="kontrakx" name="kontrakx" type="text" class="easyui-textbox" style="width:204px;"></div>
                </div>  
            </div>
        </div>
        <div class="col-sm-12" style="padding-bottom: 10px;">
            <div class="col-sm-4" style="padding-top: 3px;"><label>Tanggal Kontrak</label></div>
            <div class="col-sm-8">
                <div class="input-group" style="width:80%;">
                  <input id="tgl_kontrak" name="tgl_kontrak" type="text" class="form-control" style="width:100%;" >
                   <span class="input-group-addon" > <i class="glyphicon glyphicon-calendar"></i></span>
                </div>
                
            </div>
        </div>
        <div style="margin-bottom:10px">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Nilai Kontrak</label></div>
                <div class="col-sm-8">
                    <input id="nil_kontrak" name="nil_kontrak" type="text" class="form-control" style="width:80%;text-align:right;">
                </div>  
            </div>
        </div>
        <div style="margin-bottom:10px">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Rekanan</label></div>
                <div class="col-sm-8">
                    <input id="rekanan" name="rekanan" type="text" class="easyui-textbox" style="width:80%;">
                </div>  
            </div>
        </div>
        <div style="margin-bottom:10px">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Kepemilikan</label></div>
                <div class="col-sm-8">
                    <input id="milik" name="milik" type="text" class="easyui-textbox" style="width:80%;">
                </div>  
            </div>
        </div>
    </div>

    <div class="col-md-6">  
        <div style="margin-bottom:10px">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Wilayah</label></div>
                <div class="col-sm-8">
                    <input id="wilayah" name="wilayah" type="text" class="easyui-textbox" style="width:80%;">
                </div>  
            </div>
        </div>
        <div style="margin-bottom:10px;margin-top:10px;">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Cara Perolehan</label></div>
                <div class="col-sm-8">
                    <input id="peroleh" name="peroleh" type="text" class="easyui-textbox" style="width:80%;">
                </div>  
            </div>
        </div>
        <div style="margin-bottom:10px">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Anggaran</label></div>
                <div class="col-sm-8">
                    <input id="s_ang" name="s_ang" type="text" class="easyui-textbox" style="width:80%;">
                </div>  
            </div>
        </div>
        <div style="margin-bottom:10px">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Jenis Dana</label></div>
                <div class="col-sm-8">
                    <input id="s_dana" name="s_dana" type="text" class="easyui-textbox" style="width:80%;">
                </div>  
            </div>
        </div>
        <div style="margin-bottom:10px">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Dasar Perolehan</label></div>
                <div class="col-sm-8">
                    <input id="dasar" name="dasar" type="text" class="easyui-textbox" style="width:80%;">
                </div>  
            </div>
        </div>
        <div style="margin-bottom:10px">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>a.nomor</label></div>
                <div class="col-sm-8">
                    <input id="nomor" name="nomor" type="text" class="easyui-textbox" style="width:80%;">
                </div>  
            </div>
        </div>
        
        <div class="col-sm-12" style="padding-bottom: 10px;">
            <div class="col-sm-4" style="padding-top: 3px;"><label>b.tanggal</label></div>
            <div class="col-sm-8">
                <div class="input-group" style="width:80%;">
                  <input id="tgl_b" name="tgl_b" type="text" class="form-control" style="width:100%;" >
                   <span class="input-group-addon" > <i class="glyphicon glyphicon-calendar"></i></span>
                </div>
                
            </div>
        </div>
        <div style="margin-bottom:10px">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Tahun Anggaran</label></div>
                <div class="col-sm-8">
                <div class="input-group" style="width:50%;">
                      <input id="tahun" name="tahun" type="text" class="form-control" style="width:100%;" >
                       <span class="input-group-addon" > <i class="glyphicon glyphicon-calendar"></i></span>
                    </div>
                </div>
                
            </div>
        </div>
    </div>
    <div style="padding-bottom: 10px;" class="col-sm-12">
        <div class="col-sm-3"><button type="button" class="btn btn-default btn-lg btn-block" onClick="javascript:back();">Kembali</button></div>
        <div class="col-sm-3"><button type="button" class="btn btn-default btn-lg btn-block" onClick="javascript:savedata();">Simpan</button></div>
        <div class="col-sm-4"><button type="button" class="btn btn-default btn-lg btn-block" onClick="javascript:tambahrincian();">Tambah Detail Barang</button></div>
        <div class="col-sm-2"><button type="button" class="btn btn-default btn-lg btn-block" onClick="javascript:hapus();">Hapus</button></div>
    </div>
</div>

<!-- Detail -->
<div class="col-md-12" id="det">
    <div class="col-md-6">
        <div style="margin-bottom:10px;margin-top:10px;">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>SP2D</label></div>
                <div class="col-sm-8">
                    <input id="sp2d" name="sp2d" type="text" class="easyui-textbox" style="width:204px;">
                </div>  
            </div>
        </div>
        <div style="margin-bottom:10px;margin-top:10px;">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Tanggal SP2D</label></div>
                <div class="col-sm-8">
                    <input id="tgl_sp2d" name="tgl_sp2d" type="text" class="easyui-textbox" style="width:204px;" readonly='true'>
                </div>  
            </div>
        </div>
        <div style="margin-bottom:10px;margin-top:10px;">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Nilai SP2D</label></div>
                <div class="col-sm-8">
                    <input id="nil_sp2d" name="nil_sp2d" type="text" class="easyui-textbox" style="width:204px;" readonly='true'>
                </div>  
            </div>
        </div>
        <div style="margin-bottom:10px;margin-top:10px;">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Kegiatan</label></div>
                <div class="col-sm-8">
                    <input id="keg" name="keg" type="text" class="easyui-textbox" style="width:204px;" readonly='true'>
                </div>  
            </div>
        </div>
        <div style="margin-bottom:10px;margin-top:10px;">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Rekening</label></div>
                <div class="col-sm-8">
                    <input id="rek" name="rek" type="text" class="easyui-textbox" style="width:204px;" readonly='true'>
                </div>  
            </div>
        </div>
        <div style="margin-bottom:10px;margin-top:10px;">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>PPN</label></div>
                <div class="col-sm-8">
                    <input id="ppn" name="ppn" type="text" class="easyui-textbox" style="width:204px;">
                </div>  
            </div>
        </div>
        <div style="margin-bottom:10px;margin-top:10px;">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Keterangan</label></div>
                <div class="col-sm-8">
                    <textarea id="ket" style="width:204px;"></textarea>
                </div>  
            </div>
        </div>
    </div>

    <div class="col-md-6">
        
        <div style="margin-bottom:10px;margin-top:10px;">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Jenis Barang</label></div>
                <div class="col-sm-8">
                    <input id="jenis" name="jenis" type="text" class="easyui-textbox" style="width:204px;">
                </div>  
            </div>
        </div>
        <!-- <div style="margin-bottom:10px;margin-top:10px;">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Kode Barang</label></div>
                <div class="col-sm-8">
                    <input id="kd_brg" name="kd_brg" type="text" class="easyui-textbox" style="width:204px;">
                </div>  
            </div>
        </div> -->
        
        <div style="margin-bottom:10px">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Kode Barang</label></div>
                <div class="col-sm-8"> 
                    <div class="input-group" style="width:80%;">
                      <input id="kd_brg" name="kd_brg" type="text" class="form-control" style="width:100%;" readonly>
                       <span class="input-group-addon" > <a href='javascript:getBarang();' class="glyphicon glyphicon-list"></a></span>
                    </div>
                </div> 
            </div>
        </div>
        <div style="margin-bottom:10px">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"></div>
                <div class="col-sm-8">
                    <span id="nm_brg" name="nm_brg" type="text"  style="width:100%;"><span>
                </div>
            </div>
        </div>
        <div style="margin-bottom:10px;margin-top:10px;">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Satuan</label></div>
                <div class="col-sm-8">
                    <input id="satuan" name="satuan" type="text" class="easyui-textbox" style="width:204px;">
                </div>  
            </div>
        </div>
        <div style="margin-bottom:10px;margin-top:10px;">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Merek</label></div>
                <div class="col-sm-8">
                    <input id="merek" name="merek" type="text" class="easyui-textbox" style="width:204px;">
                </div>  
            </div>
        </div>
        <div style="margin-bottom:10px;margin-top:10px;">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Harga</label></div>
                <div class="col-sm-8">
                    <input id="hrg" name="hrg" type="text" class="form-control" style="width:80%;text-align:right;" onkeyup="hitung()"> 
                </div>  
            </div>
        </div>
        <div style="margin-bottom:10px;margin-top:10px;">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Jumlah</label></div>
                <div class="col-sm-8">
                    <input id="jumlah" name="jumlah" type="text" class="form-control" style="width:80%;text-align:right;" onkeyup="hitung()"> 
                </div>  
            </div>
        </div>
        <div style="margin-bottom:10px;margin-top:10px;">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Total</label></div>
                <div class="col-sm-8">
                    <input id="total" name="total" type="text" class="form-control" style="width:80%;text-align:right;"> 
                </div>  
            </div>
        </div> 
    </div>
 
    <div class="col-md-12" align="center" style="padding-bottom: 12px;">  
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-al_save" id="tampung" onclick="tampung()" style="width:90px">Tampung</a>  
                <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-al_new" onclick="kosong_det()" style="width:80px">Baru</a> 
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-al_done" onclick="selesai()" style="width:90px">Selesai</a>
    </div>
</div>

<!-- Gabung -->
<div class="col-md-12">
    <table id="dg" name="dg"></table>
    <div class="col-sm-6"> </div>
    <div class="col-sm-6"> 
        <div style="margin-bottom:10px;margin-top:10px;">
            <div class="col-sm-12" style="padding-bottom: 10px;">
                <div class="col-sm-4" style="padding-top: 3px;"><label>Total</label></div>
                <div class="col-sm-8">
                    <input id="ztotal" name="ztotal" type="text" class="form-control" style="width:80%;text-align:right;"> 
                </div>  
            </div>
        </div> 
    </div>
</div>

<!-- Dialog Modal-->
<div id="dlg" class="easyui-dialog" style="width:900px" closed="true" buttons="#dlg-buttons">
        <div class="row" style="width: 100%">
        <form id="popfm" method="post" novalidate style="padding: 8px;" enctype="multipart/form-data">
             <div class="col-sm-4 col-sm-offset-2" align="right" style="float: right;">
                <form class="navbar-right">
                    <div class="input-group">
                        <input type="text" value="" id="keyword" name="keyword" class="form-control" placeholder="Ketik Barang Yang Dicari">
                        <span class="input-group-btn"><button type="button" class="btn btn-default" onClick="javascript:getBarang();"><i class="fa fa-search"></i></button></span>
                    </div>
                </form>
            </div>&nbsp;<br>&nbsp;
            <div class="col-md-11">
                <div class="row">                    
                        <table id="dgBarang"></table>
                </div>
                
            </div>  
            </form>
        </div>
</div>

<div id="dlg-buttons"> 
    <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-add" onclick="javascript:$('#dlg').dialog('close')" style="width:90px">Selesai</a>
    <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-undo" onclick="javascript:$('#dlg').dialog('close')" style="width:90px">Kembali</a>
</div>

<script type="text/javascript" src="<?php echo site_url('assets/easyui/numberFormat.js'); ?>"></script>
<script type="text/javascript" src="<?php echo site_url('assets/easyui/autoCurrency.js') ?>"></script>
<script type="text/javascript">
    document.getElementById("nil_kontrak").disabled = true; 
    $("#km").hide(); 
    $('#det').hide();
    $('#head').show();
    $('#ztotal').val('0');
    xkdskpd='';
    jen='';
    vsb = 1;
    status = localStorage.getItem('status');
    // alert(status);
     
    var nilai_kontrak = document.getElementById('nil_kontrak');
    nilai_kontrak.addEventListener('keyup', function(e) {
        nilai_kontrak.value = formatRupiah(this.value);
    });

    var hrg = document.getElementById('hrg');
    hrg.addEventListener('keyup', function(e) {
        hrg.value = formatRupiah(this.value);
    });

    function numfor(x) {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function alphanumericOnly(e) {
        return restrictChars( e, "0123456789.");
    }

    function restrictChars(e, validList) {
       var key, keyChar;
       key = getKey(e);

       if (key == null) return true;
        keyChar = String.fromCharCode(key).toLowerCase();

       if (validList.toLowerCase().indexOf(keyChar) != -1){
         return true;
       }else if (key==0 || key==8 || key==9 || key==13 || key==27){
         return true;
       }else{
        alert('Karakter Tidak Di ijinkan');
        return false;
       }
    }

    function getKey(e) {
           if (window.event)
             return window.event.keyCode;
           else if (e)
             return e.which;
           else
             return null;
    }

    function tambahrincian(){
        $('#det').show();
        $('#head').hide();
    }

    function selesai(){
        $('#det').hide();
        $('#head').show();
    }

    function hitung() { 
        var a = angka($('#jumlah').val());
        var b = angka($('#hrg').val());
        var tot = a*b;
        tot = number_format(tot, 2,'.',',');        
        $('#total').val(tot);
    }

    function kosong_det(){
        $('#kd_brg').val('');
        $('#sp2d').combogrid('setValue','');
        $('#tgl_sp2d').textbox('setValue','');
        $('#nil_sp2d').textbox('setValue','');
        $('#keg').textbox('setValue','');
        $('#rek').textbox('setValue','');
        $('#ppn').textbox('setValue','');
        $('#ket').val('');
        $('#jenis').combogrid('setValue','');
        $('#satuan').combogrid('setValue','');
        $('#merek').textbox('setValue','');
        $('#hrg').val('');
        $('#jumlah').val('');
        $('#total').val('');
    }

    function deleterow(target){ 
        var rows          = $('#dg').datagrid('getSelected');
        var idx = $('#dg').datagrid('getRowIndex',rows);
        var tny = confirm('Yakin Ingin Menghapus Data, ?');
        
        if ( tny == true ) {
            
            $('#dg').datagrid('deleteRow',idx);     
            $('#dg').datagrid('unselectAll');    
           
        } 
      
    }

    function tampung(){
        t_kd_brg        = $('#kd_brg').val();
        t_no_sp2d       = $('#sp2d').val();
        t_tgl_sp2d      = $('#tgl_sp2d').val();
        t_nilai_sp2d    = $('#nil_sp2d').val();
        t_kd_kegiatan   = $('#keg').val();
        t_kd_rek5       = $('#rek').val();
        t_ppn           = $('#ppn').val();
        t_keterangan    = $('#ket').val();
        t_jns           = $('#jenis').val();
        t_satuan        = $('#satuan').val();
        t_merek         = $('#merek').val();
        t_harga         = $('#hrg').val();
        t_jumlah        = $('#jumlah').val();
        t_total         = $('#total').val();
        tz_tot          = $('#ztotal').val();
 
        $('#dg').datagrid('appendRow',
            {kd_brg:t_kd_brg,no_sp2d:t_no_sp2d,tgl_sp2d:t_tgl_sp2d,nilai_sp2d:t_nilai_sp2d,kd_kegiatan:t_kd_kegiatan,kd_rek5:t_kd_rek5,ppn:t_ppn,keterangan:t_keterangan,jns:t_jns,satuan:t_satuan,merek:t_merek,harga:t_harga,jumlah:t_jumlah,total:t_total});  
        htz = angka(t_total)+angka(tz_tot);
        // ssa = numfor(htz);
        // alert(ssa); return;
        $('#ztotal').val(numfor(htz));
        kosong_det();
    }

    function back() {
        localStorage.clear();
        window.location.href = "<?php echo base_url(); ?>transaksi/C_Dok"; 
    }

    function hapus(){
        s_skpd = $('#kd_skpd').val();
        s_idlock = d_id_lock;
        var tny = confirm('Yakin Ingin Menghapus Data, ?');
        
        if ( tny == true ) {
            $.ajax({
                type : 'post',
                url : '<?php echo base_url(); ?>transaksi/C_Dok/hapus',
                data : ({skpd:s_skpd, id_lock:s_idlock}), 
                success : function(data){
                    if(data=='1'){
                        iziToast.success({
                            title: 'OK',
                            message: 'Data Berhasil Terhapus. . .',
                        });
                        back();
                    }else{
                        iziToast.error({
                            title: 'Error',
                            message: 'Data Gagal Terhapus. . .',
                        });
                    }
                }
            });
        }  
    }

    function getBarang(){  
        xkey = $("#keyword").val(); 
        rinci = $("#rincian").val();

        if(jen==''){
            iziToast.error({
                title: 'Error',
                message: 'Pilih Jenis Barang Terlebih Dahulu',
            });
            return
        }
        $('#dgBarang').datagrid({
            width: '111%',
            height: '300',
            rownumbers: true,
            remoteSort: false,
            singleSelect:true,
            nowrap: true,
            pagination: true,
            url:'<?php echo base_url(); ?>transaksi/C_Dok/load_barang',
            queryParams:({kod: jen, key:xkey}),
            loadMsg: 'Tunggu Sebentar ... !', 
            frozenColumns:[[
                {field:'ck',title:'',width:1,align:'center',checkbox:true},
            ]],
            columns:[[
                {field:'kd_brg', title:'Kode', width:220, align:"left"},
                {field:'nm_brg',title:'Nama Barang',width:620,align:"left"}
            ]],
            onSelect:function(rowIndex,rowData){  
                $("#kd_brg").val(rowData.kd_brg);
                $("#nm_brg").text(rowData.nm_brg);
                max_number(rowData.kd_brg);
           }  

        });
        $('#dlg').dialog('open').dialog('center').dialog('setTitle','Pilih Barang');
    }

    function savedata(){ 
        s_skpd = $('#kd_skpd').val();
        s_unit = $('#kd_unit').val();
        if(vsb==1){
            s_kontrak =$('#kontrak').val();
        }else{
            s_kontrak =$('#kontrakx').val();
        }
        s_tgl_kontrak   = $('#tgl_kontrak').val();
        s_nil_kontrak   = angka($('#nil_kontrak').val());
        s_rekanan       = $('#rekanan').val();
        s_milik         = $('#milik').val();
        s_wilayah       = $('#wilayah').val();
        s_peroleh       = $('#peroleh').val();
        s_s_ang         = $('#s_ang').val();
        s_s_dana        = $('#s_dana').val();
        s_dasar         = $('#dasar').val();
        s_nomor         = $('#nomor').val();
        s_tgl_b         = $('#tgl_b').val();
        s_tahun         = $('#tahun').val();
        s_ztotal        = angka($('#ztotal').val());
        s_data1         = $('#dg').datagrid('getRows');
        if(status=='detail'){
            s_idlock = d_id_lock;
        }else{
            s_idlock = '';
        }

        if (s_data1.length==0){
            iziToast.error({
                    title: 'Error',
                    message: 'Detail Belum Diisi. . .',
                });
        }else{ 
        $.post('<?php echo base_url(); ?>transaksi/C_Dok/saveData', {id_lock:s_idlock,status:status,skpd:s_skpd,unit:s_unit,kontrak:s_kontrak,tgl_kontrak:s_tgl_kontrak,nil_kontrak:s_nil_kontrak,rekanan:s_rekanan,milik:s_milik,wilayah:s_wilayah,peroleh:s_peroleh,s_ang:s_s_ang,s_dana:s_s_dana,dasar:s_dasar,nomor:s_nomor,tgl_b:s_tgl_b,tahun:s_tahun,ztotal:s_ztotal,detail:JSON.stringify(s_data1)}, function(result) {
 
        if (result.notif){
                iziToast.success({
                    title: 'OK',
                    message: result.message,
                });
                // location.reload();
            } else {
                iziToast.error({
                    title: 'Error',
                    message: result.message,
                });
            }
        }, "json");

        }

    }

    function getdetail(){
        d_status        = localStorage.getItem('status');
        d_id            = localStorage.getItem('id');
        d_no_dokumen    = localStorage.getItem('no_dokumen');
        d_kd_comp       = localStorage.getItem('kd_comp');
        d_tgl_dokumen   = localStorage.getItem('tgl_dokumen');
        d_kd_milik      = localStorage.getItem('kd_milik');
        d_nilai_kontrak = localStorage.getItem('nilai_kontrak');
        d_kd_wilayah    = localStorage.getItem('kd_wilayah');
        d_kd_skpd       = localStorage.getItem('kd_skpd');
        d_kd_unit       = localStorage.getItem('kd_unit');
        d_s_dana        = localStorage.getItem('s_dana');
        d_tahun         = localStorage.getItem('tahun');
        d_s_ang         = localStorage.getItem('s_ang');
        d_kd_cr_oleh    = localStorage.getItem('kd_cr_oleh');
        d_b_dasar       = localStorage.getItem('b_dasar');
        d_b_nomor       = localStorage.getItem('b_nomor');
        d_b_tanggal     = localStorage.getItem('b_tanggal');
        d_h_total       = localStorage.getItem('h_total');
        d_id_lock       = localStorage.getItem('id_lock');

        $('#kd_skpd').combogrid('setValue',d_kd_skpd);
        $('#kd_unit').combogrid('setValue',d_kd_unit);
        $('#kontrak').combogrid('setValue',d_no_dokumen);
        $('#kontrakx').val(d_no_dokumen);
        $('#tgl_kontrak').val(d_tgl_dokumen);
        $('#nil_kontrak').val(numfor(d_nilai_kontrak));
        $('#rekanan').combogrid('setValue',d_kd_comp);
        $('#milik').combogrid('setValue',d_kd_milik);
        $('#wilayah').combogrid('setValue',d_kd_wilayah);
        $('#peroleh').combogrid('setValue',d_kd_cr_oleh);
        $('#s_ang').combogrid('setValue',d_s_ang);
        $('#s_dana').combogrid('setValue',d_s_dana);
        $('#dasar').combogrid('setValue',d_b_dasar);
        $('#nomor').textbox('setValue',d_b_nomor);
        $('#tgl_b').val(d_b_tanggal);
        $('#tahun').val(d_tahun);
        $('#ztotal').val(numfor(d_h_total));

        $('#dg').datagrid({
            url:'<?php echo site_url('transaksi/C_Dok/load_detail') ?>',
            queryParams:{idLock: d_id_lock, kode: d_kd_skpd},
        });

    }
// =============================================================================================================================================================
    $(document).ready(function(){
         
        $('#sb').switchbutton({
            checked: true,
            onChange: function(checked){
                if(checked==true){       
                    vsb = 1;     
                    $("#kn").show(); 
                    $("#km").hide(); 
                    document.getElementById("nil_kontrak").disabled = true; 
                }else{
                    vsb = 0;
                    $("#km").show(); 
                    $("#kn").hide(); 
                    document.getElementById("nil_kontrak").disabled = false; 
                }
            }
        });

        function getToday() {
          var d = new Date();
          var month = d.getMonth()+1;
          var day = d.getDate();
          var output = ((''+day).length<2 ? '0' : '') + day + '-' +
                       ((''+month).length<2 ? '0' : '') + month + '-' +
                       d.getFullYear();
          return output;
        }

        $('#tgl_kontrak').datepicker({
              format: 'dd-mm-yyyy',
              autoclose: true
        });

        $('#tgl_b').datepicker({
              format: 'dd-mm-yyyy',
              autoclose: true
        });

        $('#tgl_b').val(getToday());

        $('#jenis').combogrid({
            panelWidth:400,  
            idField:'jenis',  
            textField:'nm_jenis',  
            mode:'remote',
            url: '<?php echo base_url(); ?>transaksi/C_Dok/getJenis', 
            columns:[[  
                {field:'nm_jenis',title:'NAMA JENIS',width:400}    
            ]],  
            onSelect:function(rowIndex,rowData){
                jen = rowData.jenis;
                
            }
        });

     

        $('#satuan').combogrid({
                panelWidth:300,  
                idField:'kd_satuan',  
                textField:'nm_satuan',  
                mode:'remote',
                url: '<?php echo base_url(); ?>transaksi/C_Dok/getSatuan',
                columns:[[  
                   {field:'nm_satuan',title:'Satuan',width:400}    
                ]],  
                onSelect:function(rowIndex,rowData){
                   nama = rowData.nm_satuan;
                   }
        });

        $('#kontrak').combogrid({
            panelWidth:940,  
            idField:'no_kontrak',  
            textField:'no_kontrak',  
            mode:'remote',
            // url: '<?php echo base_url(); ?>transaksi/C_Dok/getKontrak', 
            frozenColumns:[[                 
               {field:'no_kontrak',title:'Nomor Kontrak',width:200},    
            ]],  
            columns:[[                 
               {field:'tgl_kontrak',title:'Tgl Kontrak',width:120, align:'center'},
               {field:'rekanan',title:'Rekanan',width:200},    
               {field:'nm_kegiatan',title:'Kegiatan',width:220, align:'left'},    
               {field:'total',title:'Nilai Kontrak',width:170, align:'right'}   
           ]], 
            onSelect:function(rowIndex,rowData){ 
                x_kont = rowData.no_kontrak;
                $('#tgl_kontrak').val(rowData.tgl_kontrak);
                $('#nil_kontrak').val(rowData.total); 
                $('#rekanan').combogrid('setValue',rowData.rekanan);
                
            }
        });

        $('#sp2d').combogrid({
            panelWidth:600,  
            idField:'no_sp2d',  
            textField:'no_sp2d',  
            mode:'remote',
            frozenColumns:[[
               {field:'no_sp2d',title:'No SP2D',width:220},
            ]],  
            columns:[[                  
               {field:'tgl_sp2d',title:'Tgl SP2D',width:100, align:'center'},    
               {field:'nilai',title:'Nilai SP2D',width:200, align:'right'},   
               {field:'kd_kegiatan',title:'Kegiatan',width:150},    
               {field:'ppn',title:'PPN',width:150, align:'right'}   
            ]],  
            onSelect:function(rowIndex,rowData){ 
                 $('#tgl_sp2d').textbox('setValue',rowData.tgl_sp2d);
                 $('#nil_sp2d').textbox('setValue',rowData.nilai);
                 $('#keg').textbox('setValue',rowData.kd_kegiatan);
                 $('#rek').textbox('setValue',rowData.kd_rek5);
                 $('#ppn').textbox('setValue',rowData.ppn); 
            }
        });

        $('#kd_skpd').combogrid({
            panelWidth:610,  
            idField:'kd_skpd',  
            textField:'nm_skpd',  
            mode:'remote',
            url: '<?php echo base_url(); ?>transaksi/C_Dok/getSkpd',
            columns:[[                 
               {field:'kd_skpd',title:'KODE SKPD',width:110},
               {field:'nm_skpd',title:'NAMA SKPD',width:500}    
            ]],  
            onSelect:function(rowIndex,rowData){
                xkdskpd = rowData.kd_skpd;
                $('#kd_unit').combogrid({
                    url:'<?php echo base_url(); ?>transaksi/C_Dok/getUnit',
                    queryParams:({kd_skpd:xkdskpd})
                });

                $('#kontrak').combogrid({ 
                    url: '<?php echo base_url(); ?>transaksi/C_Dok/getKontrak?skpd='+xkdskpd, 
                });

                $('#sp2d').combogrid({
                    url: 'http://localhost/simakda_bantaeng/api.php?pilih=F_sp2d&skpd='+xkdskpd, 
                    // url: '<?php echo base_url(); ?>transaksi/C_Dok/getSp2d', 
                    // queryParams : ({kontrak:x_kont}),
                });
            }
        });

        $('#kd_unit').combogrid({
            panelWidth:600,  
            idField:'kd_unit',  
            textField:'nm_unit',  
            mode:'remote', 
            columns:[[                 
               {field:'kd_unit',title:'KODE UNIT',width:110},
               {field:'nm_unit',title:'NAMA UNIT',width:500}    
            ]],  
            onSelect:function(rowIndex,rowData){
                
            }
        });

        $('#rekanan').combogrid({
            panelWidth:500,  
            idField:'kd_comp',  
            textField:'nm_comp',  
            mode:'remote',
            url: '<?php echo base_url(); ?>transaksi/C_Dok/get_comp',
            columns:[[  
               {field:'nm_comp',title:'Nama Perusahaan',width:600}    
            ]],  
            onSelect:function(rowIndex,rowData){
               nama = rowData.nm_comp;
            }
        });

        $('#milik').combogrid({
            panelWidth:220,  
            idField:'kd_milik',  
            textField:'nm_milik',  
            mode:'remote',
            url: '<?php echo base_url(); ?>transaksi/C_Dok/getMilik',
            columns:[[  
               {field:'nm_milik',title:'Kepemilikan',width:200}    
            ]],
            onSelect:function(rowIndex,rowData){
                nama = rowData.nm_milik;
                }
        });

        $('#wilayah').combogrid({
            panelWidth:300,  
            idField:'kd_wilayah',  
            textField:'nm_wilayah',  
            mode:'remote',
            url:'<?php echo base_url(); ?>transaksi/C_Dok/getWilayah', 
            columns:[[  
               {field:'nm_wilayah',title:'Wilayah',width:300}    
            ]],
            onSelect:function(rowIndex,rowData){
                nama        = rowData.nm_wilayah;
            }
        });

        $('#peroleh').combogrid({
            panelWidth:250,  
            idField:'kd_cr_oleh',  
            textField:'cara_peroleh',  
            mode:'remote',
            url:'<?php echo base_url(); ?>transaksi/C_Dok/getOleh', 
            columns:[[                 
               {field:'cara_peroleh',title:'Cara Perolehan',width:250}    
            ]],
            onSelect:function(rowIndex,rowData){
            }
        });

        $('#s_ang').combogrid({
            panelWidth:220,  
            idField:'kd_bukti',  
            textField:'nm_bukti',  
            mode:'remote',
            url: '<?php echo base_url(); ?>transaksi/C_Dok/getbukti',
            columns:[[  
               {field:'nm_bukti',title:'Bukti Pembayaran',width:200}    
            ]],
            onSelect:function(rowIndex,rowData){
                nama = rowData.nm_bukti;
                }
        });

        $('#s_dana').combogrid({
            panelWidth:220,  
            idField:'kd_dana',  
            textField:'nm_dana',  
            mode:'remote',
            url: '<?php echo base_url(); ?>transaksi/C_Dok/getdana',
            columns:[[  
               {field:'nm_dana',title:'Jenis Dana',width:200}    
            ]],
            onSelect:function(rowIndex,rowData){
                nama = rowData.nm_dana;
                }
        });

        $('#dasar').combogrid({
            panelWidth:200,  
            idField:'kode',  
            textField:'dasar_peroleh',  
            mode:'remote',
            url:'<?php echo base_url(); ?>transaksi/C_Dok/getDasar', 
            columns:[[  
               {field:'dasar_peroleh',title:'Cara Peroleh',width:200}    
            ]],
            onSelect:function(rowIndex,rowData){
            }
        });

        $('#tahun').datepicker({
            minViewMode: 'years',
            autoclose: true,
            format: 'yyyy'
        });

        $('#dg').datagrid({
            // url:'<?php echo site_url('transaksi/C_Dok/load_detail') ?>',
            // queryParams:{no: no_dokumen, kode: kd_uskpd},
            idField:'id',
            width: '1000',
            height: '300',
            nowrap: true,
            pagination: true,
            rownumbers: true,
            fitColumns: true,
            singleSelect: true,
            remoteSort: true,  
            loadMsg: 'Tunggu Sebentar ... !',
            frozenColumns:[[ 
                {field:'kd_brg',title:'Kode Barang',width:220,halign:"center",align:'left'},
            ]],
            columns:[[
                {field:'no_sp2d', title:'No SP2D', width:150, halign:"center",align:"left"},
                {field:'tgl_sp2d',title:'Tanggal SP2D',width:150,halign:"center",align:"left",hidden:'true'},
                {field:'nilai_sp2d',title:'nilai_sp2d',width:100,align:'center',hidden:'true'},
                {field:'kd_kegiatan',title:'kd_kegiatan',width:50,align:'center',hidden:'true'},
                {field:'kd_rek5',title:'kd_rek5',width:50,align:'center',hidden:'true'},
                {field:'ppn',title:'ppn',width:50,align:'center',hidden:'true'},
                {field:'keterangan',title:'keterangan',width:100,align:'center',hidden:'true'},
                {field:'jns',title:'jns',width:100,align:'center',hidden:'true'},
                {field:'satuan',title:'satuan',width:100,align:'center',hidden:'true'},
                {field:'merek',title:'merek',width:100,align:'center',hidden:'true'},  
                {field:'harga',title:'Harga/Unit',width:110,halign:"center",align:"right"},
                {field:'jumlah',title:'jumlah',width:70,align:'center'},
                {field:'total',title:'Total',width:110,halign:"center",align:"right"},
                {field:'action',title:'',width:30,align:'center',
                    formatter:function(value,row,index){ 
                        return d = '<a href="javascript:void(0)" onclick="deleterow(this)"><i class="fa fa-trash-o" aria-hidden="true"></i></a>';
                    }
                },
            ]]  
        });

        if(status=='detail'){ 
            getdetail();
        }

    });
</script>

